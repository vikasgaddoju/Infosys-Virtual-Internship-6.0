{% extends "quizzes/base_quiz.html" %}
{% block title %}Quiz Results – {{ quiz_attempt.subcategory.name }}{% endblock %}

{% block quiz_content %}
  <div style="display:flex;align-items:center;gap:16px;justify-content:space-between;">
    <div>
      <h2 class="q-text">Your Score: {{ percentage }}%</h2>
      <p class="muted">You answered {{ correct }} correctly out of {{ total }}.</p>
    </div>
    <div style="text-align:right">
      <div style="font-size:28px;font-weight:700;color:var(--accent)">{{ percentage }}%</div>
      <div class="muted">Grade: <strong>{{ grade }}</strong></div>
    </div>
  </div>

  <hr style="margin:18px 0; border-color: rgba(255,255,255,0.03)">

  <h3 style="margin-bottom:10px">Review Questions</h3>
  <ol style="padding-left:18px">
    {% for q in quiz_attempt.questions %}
      <li style="margin-bottom:14px">
        <p style="margin:0 0 6px 0; font-weight:600">{{ q.question }}</p>
        <div class="muted" style="font-size:14px">A. {{ q.option_a }} &nbsp; | &nbsp; B. {{ q.option_b }} &nbsp; | &nbsp; C. {{ q.option_c }} &nbsp; | &nbsp; D. {{ q.option_d }}</div>
        <div style="margin-top:6px">
          <span style="font-weight:700; color: {% if q.is_correct %}var(--accent){% else %}var(--danger){% endif %}">Your answer: {{ q.user_answer|default:"-" }}</span>
          {% if not q.is_correct %}
            <span class="muted" style="margin-left:12px">Correct: {{ q.correct_answer }}</span>
          {% endif %}
        </div>
        {% if q.explanation %}
          <div style="margin-top:6px; color: var(--muted); font-size:13px"><em>Explanation:</em> {{ q.explanation }}</div>
        {% endif %}
      </li>
    {% endfor %}
  </ol>

  <div style="margin-top:12px; display:flex; gap:10px;">
    <a class="btn" href="{% url 'quizzes:dashboard' %}">Back to Dashboard</a>
    <a class="btn secondary" href="{% url 'quizzes:categories' %}">Try another quiz</a>
  </div>
{% endblock %}

{% block extra_scripts %}
<script>
// Keep your original "Time's Up!" popup (unchanged)
(function(){
  const urlParams = new URLSearchParams(window.location.search);
  const autoSubmitted = urlParams.get('auto_submitted') === 'true';
  
  if(autoSubmitted){
    showAutoSubmitPopup();
  }
  
  function showAutoSubmitPopup(){
    const overlay = document.createElement('div');
    overlay.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      animation: fadeIn 0.3s ease-in-out;
    `;
    
    const popup = document.createElement('div');
    popup.style.cssText = `
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 32px;
      max-width: 420px;
      width: 90%;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
      animation: slideUp 0.4s cubic-bezier(0.2, 0.9, 0.2, 1);
    `;
    
    const icon = document.createElement('div');
    icon.innerHTML = '⏱️';
    icon.style.cssText = `
      font-size: 48px;
      margin-bottom: 16px;
    `;
    
    const title = document.createElement('h2');
    title.textContent = 'Time\'s Up!';
    title.style.cssText = `
      color: #f6fbff;
      margin: 0 0 8px 0;
      font-size: 24px;
      font-weight: 700;
    `;
    
    const message = document.createElement('p');
    message.textContent = 'Your quiz has been automatically submitted because the time limit has been reached.';
    message.style.cssText = `
      color: #94a3b8;
      margin: 0 0 24px 0;
      line-height: 1.5;
      font-size: 14px;
    `;
    
    const button = document.createElement('button');
    button.textContent = 'View Results';
    button.style.cssText = `
      background: linear-gradient(90deg, #7c93ff, #6ee7b7);
      color: #052233;
      border: none;
      padding: 12px 28px;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      font-size: 14px;
      box-shadow: 0 8px 24px rgba(124, 147, 255, 0.3);
      transition: transform 160ms, box-shadow 160ms;
    `;
    
    button.addEventListener('mouseover', () => {
      button.style.transform = 'translateY(-2px)';
      button.style.boxShadow = '0 12px 32px rgba(124, 147, 255, 0.4)';
    });
    
    button.addEventListener('mouseout', () => {
      button.style.transform = 'translateY(0)';
      button.style.boxShadow = '0 8px 24px rgba(124, 147, 255, 0.3)';
    });
    
    button.addEventListener('click', () => {
      overlay.remove();
    });
    
    popup.appendChild(icon);
    popup.appendChild(title);
    popup.appendChild(message);
    popup.appendChild(button);
    overlay.appendChild(popup);
    document.body.appendChild(overlay);
    
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    `;
    document.head.appendChild(style);
  }
})();

// NEW: Force sidebar timer to 00:00 on results page
document.addEventListener('DOMContentLoaded', function() {
  // Find all elements that contain exactly MM:SS format
  document.querySelectorAll('div, span, p').forEach(el => {
    const text = el.textContent.trim();
    if (text.match(/^\d{2}:\d{2}$/)) {
      el.textContent = "00:00";
    }
  });
});
</script>
{% endblock %}